import{d as ce,r as C,u as de,a as g,b as ue,c as me,e as G,f as c,g as _,h as i,i as n,w as l,j as pe,k as w,F as R,l as T,m as fe,n as y,o as _e,p as m,q as a,s as z,t as D,v as x,x as ve,y as ye,z as he,A as ke}from"./index-DByUEM-I.js";const be={class:"d-flex align-center justify-center"},ge={style:{width:"600px"}},xe={key:0},Ce={key:1},we={key:0},ze={key:0,class:"position-relative"},Ee={class:"position-sticky top-0 mt-n4 mx-n4 px-4 pt-4 bg-background",style:{"z-index":"1"}},Ve={class:"d-flex align-center"},Pe={key:0},$e={key:1},Be={class:"ml-4"},Re={key:1,class:"pt-4 px-4"},De={class:"d-flex align-center justify-space-evenly flex-wrap"},je={key:2},Se={class:"d-flex align-center justify-space-between"},Ie={key:0},Ne={key:0},Te={key:1},Le={key:1},qe={key:0},Fe={key:1},Ue={key:1},Ae={key:1},He=ce({__name:"RoomView",setup(Me){const b=localStorage.getItem("device"),h=fe().params.id,E=C(null),j=C(!1),L=C(""),V=C(!1),H=C(5e3),{data:r,pending:J,error:K}=de(g(y,"theplanningpoker",h)),{data:f,pending:Q,error:W}=ue(me(y,"theplanningpoker",h,"participants"));let S=G(()=>!r.value||!f.value?null:r.value.status==="hide"?F(f.value.slice()):X(f.value.slice())),q=G(()=>{if(!r.value||!f.value||r.value.status==="hide")return null;let e=F(f.value.slice());const t=e.reduce((d,v)=>(v.estimate?d.includes(v.estimate)||d.push(v.estimate):d.includes("null")||d.push("null"),d),[]),u=t.filter(d=>d!=="null"&&d!=="?").sort((d,v)=>{const P=I(e,d).length,p=I(e,v).length;return P===p?d.localeCompare(v):p-P});t.includes("?")&&u.push("?"),t.includes("null")&&u.push("null");const o=[];return u.forEach(d=>o.push({estimate:d,participants:I(e,d)})),o});function I(e,t){return e.filter(u=>!u.estimate&&(!t||t==="null")||u.estimate&&t===u.estimate)}function F(e){return e.sort((t,u)=>t.name.localeCompare(u.name))}function X(e){return e.sort((t,u)=>U(t.estimate)-U(u.estimate))}function U(e){return e?e==="?"?1:e==="0"?2:e==="1"?3:e==="2"?4:e==="3"?5:e==="5"?6:e==="8"?7:8:0}function A(e){return e?e==="?"?"mdi-help":e==="0"?"mdi-numeric-0":e==="1"?"mdi-numeric-1":e==="2"?"mdi-numeric-2":e==="3"?"mdi-numeric-3":e==="5"?"mdi-numeric-5":e==="8"?"mdi-numeric-8":"mdi-plus":"mdi-minus"}async function Y(){j.value=!0;const e=g(y,"theplanningpoker",h,"participants",b);await ye(e,{name:E.value,estimate:null}),j.value=!1}async function Z(e){const t=g(y,"theplanningpoker",h,"participants",e);await he(t)}async function ee(e){if(!e)return;const t=ke(y),u=g(y,"theplanningpoker",h);t.update(u,{status:e==="hide"?"show":"hide"}),e==="show"&&f.value&&f.value.length&&f.value.forEach(o=>{if(o.estimate){const d=g(y,"theplanningpoker",h,"participants",o.id);t.update(d,{estimate:null})}}),await t.commit()}async function k(e){if(!e)return;const t=g(y,"theplanningpoker",h,"participants",b);await _e(t,{estimate:e})}function te(e){navigator.clipboard.writeText(window.location.origin+"/"+e),L.value="¡Link copiado!",V.value=!0}function ne(e,t){return e!=="hide"?"primary":"accent"}function ie(e,t){return e==="hide"?"plain":"flat"}return(e,t)=>{const u=m("v-skeleton-loader"),o=m("v-btn"),d=m("v-toolbar"),v=m("v-card-title"),P=m("v-card-item"),p=m("v-icon"),se=m("v-chip"),$=m("v-card-text"),B=m("v-card"),ae=m("v-text-field"),oe=m("v-card-actions"),le=m("v-menu"),M=m("v-empty-state"),re=m("v-snackbar");return a(),c(R,null,[_("main",null,[_("div",be,[_("div",ge,[i(J)||i(Q)?(a(),c("div",xe,[n(u,{type:"heading, ossein, subtitle"})])):(a(),c("div",Ce,[!i(K)&&!i(W)?(a(),c("div",we,[i(r)?(a(),c("div",ze,[_("header",Ee,[n(B,null,{default:l(()=>[n(d,{color:"transparent"},{append:l(()=>[n(o,{size:"small",icon:"mdi-share-variant",onClick:t[0]||(t[0]=s=>te(i(r).id))}),n(o,{size:"small",icon:i(r).status==="hide"?"mdi-eye":"mdi-eye-off",onClick:t[1]||(t[1]=s=>ee(i(r).status))},null,8,["icon"])]),_:1}),n(P,{class:"pt-0"},{default:l(()=>[n(v,null,{default:l(()=>[z(D(i(r).name),1)]),_:1})]),_:1}),i(q)?(a(),x($,{key:0},{default:l(()=>[(a(!0),c(R,null,T(i(q),(s,N)=>(a(),x(B,{key:N,class:ve({"mt-4":N>0}),variant:"tonal"},{default:l(()=>[n($,null,{default:l(()=>[_("div",Ve,[n(o,{icon:"",size:"small",class:"btn-fs-1",color:"primary"},{default:l(()=>[s.estimate==="null"?(a(),c("span",Pe,[n(p,{icon:"mdi-minus"})])):(a(),c("span",$e,[n(p,{icon:A(s.estimate)},null,8,["icon"])]))]),_:2},1024),_("div",Be,[(a(!0),c(R,null,T(s.participants,O=>(a(),x(se,{key:O.id,class:"ma-1"},{default:l(()=>[z(D(O.name),1)]),_:2},1024))),128))])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})):w("",!0)]),_:1})]),i(f)&&!i(f).some(s=>s.id===i(b))?(a(),c("form",{key:0,onSubmit:pe(Y,["prevent"]),class:"mt-4"},[n(ae,{modelValue:E.value,"onUpdate:modelValue":t[2]||(t[2]=s=>E.value=s),variant:"solo",label:"Ingresar como",clearable:""},{append:l(()=>[n(o,{type:"submit",color:"primary",icon:"mdi-plus",disabled:!E.value,loading:j.value},null,8,["disabled","loading"])]),_:1},8,["modelValue"])],32)):i(f)&&i(f).some(s=>s.id===i(b))&&i(r).status==="hide"?(a(),c("div",Re,[_("div",De,[n(o,{color:"primary",size:"small",icon:"mdi-help",class:"btn-fs-1 ma-2",disabled:i(r).status!=="hide",onClick:t[3]||(t[3]=s=>k("?"))},null,8,["disabled"]),n(o,{color:"primary",size:"small",icon:"mdi-numeric-0",class:"btn-fs-1 ma-2",disabled:i(r).status!=="hide",onClick:t[4]||(t[4]=s=>k("0"))},null,8,["disabled"]),n(o,{color:"primary",size:"small",icon:"mdi-numeric-1",class:"btn-fs-1 ma-2",disabled:i(r).status!=="hide",onClick:t[5]||(t[5]=s=>k("1"))},null,8,["disabled"]),n(o,{color:"primary",size:"small",icon:"mdi-numeric-2",class:"btn-fs-1 ma-2",disabled:i(r).status!=="hide",onClick:t[6]||(t[6]=s=>k("2"))},null,8,["disabled"]),n(o,{color:"primary",size:"small",icon:"mdi-numeric-3",class:"btn-fs-1 ma-2",disabled:i(r).status!=="hide",onClick:t[7]||(t[7]=s=>k("3"))},null,8,["disabled"]),n(o,{color:"primary",size:"small",icon:"mdi-numeric-5",class:"btn-fs-1 ma-2",disabled:i(r).status!=="hide",onClick:t[8]||(t[8]=s=>k("5"))},null,8,["disabled"]),n(o,{color:"primary",size:"small",icon:"mdi-numeric-8",class:"btn-fs-1 ma-2",disabled:i(r).status!=="hide",onClick:t[9]||(t[9]=s=>k("8"))},null,8,["disabled"])])])):w("",!0),i(S)&&i(S).length?(a(),c("div",je,[(a(!0),c(R,null,T(i(S),s=>(a(),x(B,{key:s.id,class:"mt-4"},{default:l(()=>[n($,null,{default:l(()=>[_("div",Se,[_("span",null,[i(b)===i(r).id?(a(),x(o,{key:0,icon:"",size:"small",class:"btn-fs-1 mr-3",color:"accent",variant:"plain"},{default:l(()=>[n(p,{icon:"mdi-close"}),n(le,{activator:"parent",location:"bottom",transition:"fade-transition"},{default:l(()=>[n(B,{"min-width":"200"},{default:l(()=>[n($,null,{default:l(()=>[z(" Confimar eliminación ")]),_:1}),n(oe,{class:"justify-end"},{default:l(()=>[n(o,{icon:"",size:"small",variant:"text"},{default:l(()=>[n(p,{icon:"mdi-close"})]),_:1}),n(o,{icon:"",size:"small",variant:"flat",color:"primary",onClick:N=>Z(s.id)},{default:l(()=>[n(p,{icon:"mdi-check"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):w("",!0),s.id===i(b)?(a(),x(p,{key:1,color:"primary",size:"extrasmall",icon:"mdi-check-decagram"})):w("",!0),z(" "+D(s.name),1)]),n(o,{icon:"",size:"small",class:"btn-fs-1",color:ne(i(r).status,s.estimate),variant:ie(i(r).status,s.estimate)},{default:l(()=>[i(r).status==="hide"?(a(),c("span",Ie,[s.estimate?(a(),c("span",Te,[n(p,{icon:"mdi-check-bold"})])):(a(),c("span",Ne,[n(p,{icon:"mdi-dots-horizontal"})]))])):(a(),c("span",Le,[s.estimate?(a(),c("span",Fe,[n(p,{icon:A(s.estimate)},null,8,["icon"])])):(a(),c("span",qe,[n(p,{icon:"mdi-minus"})]))]))]),_:2},1032,["color","variant"])])]),_:2},1024)]),_:2},1024))),128))])):w("",!0)])):(a(),c("div",Ue,[n(M,{headline:"¡Error!",title:"Proyecto cerrado",text:"El proyecto al que intentas ingresar ha sido eliminado",icon:"mdi-alert-octagon",class:"my-16"})]))])):(a(),c("div",Ae,[n(M,{headline:"¡Error del servidor!",title:"Error de carga de datos",text:"Se produjo un error en el servidor mientras se cargaban los datos, por favor actualice la página",icon:"mdi-alert-octagon",class:"my-16"})]))]))])])]),n(re,{modelValue:V.value,"onUpdate:modelValue":t[11]||(t[11]=s=>V.value=s),timeout:H.value},{actions:l(()=>[n(o,{icon:"mdi-close",onClick:t[10]||(t[10]=s=>V.value=!1)})]),default:l(()=>[z(D(L.value)+" ",1)]),_:1},8,["modelValue","timeout"])],64)}}});export{He as default};
